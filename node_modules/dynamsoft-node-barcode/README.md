# Dynamsoft JavaScript Barcode SDK for Node

>  This library is the Node.js edition of Dynamsoft Barcode Reader. If you are looking to implement barcode reading feature in a web page, please check out the other library [Dynamsoft JavaScript Barcode SDK for Web](https://www.npmjs.com/package/dynamsoft-javascript-barcode).

Both 1D and 2D barcode symbologies are supported including the popular `Code 39`, `EAN-13`, `QR`, `PDF417`, etc. Find the full list [here](https://www.dynamsoft.com/barcode-reader/overview/?utm_source=node&package=js).

The library is based on `webassembly` which has been an official feature of Node.js since `LTS 8`. If you are using Node.js LTS 8 and have no plan to upgrade it, check out [how to use the library in Node.js LTS 8](#how-to-use-the-library-in-nodejs-lts-8). That said, Node.js version >= LTS 12 is recommended because the library will try to use `worker_threads` when decoding. 

Node.js 15+ is required when using an online license.
> **Technical Support**
>
> Note that the node.js edition of the Barcode Reader may not be updated in time. If you need technical support, you can contact [Dynamsoft support](https://www.dynamsoft.com/company/contact/?utm_source=node&package=js) or create issues in
https://github.com/Dynamsoft/javascript-barcode.

## Get Started

* Check your Node.js version

```shell
> node -v
v12.13.1
```

* Installs the library from npm

```shell
> npm install dynamsoft-node-barcode --save
```
* Create a `js` file and include the library

```js
let DBR = require("dynamsoft-node-barcode");
```

The following also works
```js
let DBR = require("path/to/dist/dbr.js");
```

> **Note**
> The library uses `Promise` a lot, so it's recommended to write the related code in a `async` function so that later you can use `await`
>
> ```js
> (async()=>{
> // many work will done here
> })();
> ```

* Create an instance of the reader

```js
let reader = await DBR.BarcodeReader.createInstance();
```

* Decode a file by its path

```js
let results = await reader.decode('path/to/sample.png');
```

Or just decode a file by its URL

```js
let results = await reader.decode('https://demo.dynamsoft.com/barcode-reader/img/AllSupportedBarcodeTypes.png');
```
> **NOTE**  
> The following image formats are supported by default: `png`, `jpg`, `bmp`, `gif`. 
>
> If you want to decode other files like `pdf`'s, you need to convert them to images first. Contact [Dynamsoft Support](https://www.dynamsoft.com/company/contact/?utm_source=node&package=js) to find out more.
>
> If you want to decode raw image data (`RGBA`) from sources like a camera. You can use the API `deocdeBuffer`. Check out [C++ API decodeBuffer](https://www.dynamsoft.com/barcode-reader/programming/cplusplus/api-reference/cbarcodereader-methods/decode.html?ver=latest&utm_source=node&package=js#decodebuffer) for more details.

* Print out the results

```js
for(let result of results){
    console.log(result.barcodeText);
}
```

* Run your code.

```shell
> node your-code.js
```

Last not but least, don't forget to set a `license key`! If you don't have a key yet, click [here](https://www.dynamsoft.com/customer/license/trialLicense?product=dbr&package=js&utm_source=node) to get one.

```js
DBR.BarcodeReader.license = 'LICENSE';
```

### Full code

```js
let DBR = require('dynamsoft-node-barcode');
// Please visit https://www.dynamsoft.com/customer/license/trialLicense?product=dbr&package=js&utm_source=node to get a trial license
DBR.BarcodeReader.license = 'LICENSE';

let pReader = null;
(async()=>{
    let reader = await DBR.BarcodeReader.createInstance();
    for(let result of await reader.decode('https://demo.dynamsoft.com/barcode-reader/img/AllSupportedBarcodeTypes.png')){
        console.log(result.barcodeText);
    }
    reader.destroy();
    
    // Since the worker keep alive, you can call
    await DBR.BarcodeReader._dbrWorker.terminate();
    // when you need to exit this process.
    // Or call
    process.exit();
    // directly.
})();

```

### Decode from more image sources

```js
let DBR = require('dynamsoft-node-barcode');
// Please visit https://www.dynamsoft.com/customer/license/trialLicense?product=dbr&package=js&utm_source=node to get a trial license
DBR.BarcodeReader.license = 'LICENSE';

(async()=>{
    console.log("============== create reader ==============");
    let reader = await BarcodeReader.createInstance();
    console.log("============== decode buffer ==============");
    let fs = require('fs');
    let buffer = fs.readFileSync(__dirname + '/sample.png');
    for(let result of await reader.decode(buffer)){
        console.log(result.barcodeText);
    }
    console.log("============== decode base64 ==============");
    let strBase64 = buffer.toString('base64');
    for(let result of await reader.decodeBase64String(strBase64)){
        console.log(result.barcodeText);
    }
    console.log("============== decode file ==============");
    for(let result of await reader.decode(__dirname + '/sample.png')){
        console.log(result.barcodeText);
    }
    console.log("============== decode url ==============");
    for(let result of await reader.decode('https://demo.dynamsoft.com/barcode-reader/img/AllSupportedBarcodeTypes.png')){
        console.log(result.barcodeText);
    }
    console.log("============== destroy reader ==============");
    await reader.destroy();
    
    // Since the worker keep alive, you can call
    await DBR._dbrWorker.terminate();
    // when you need to exit this process.
    // Or call
    process.exit();
    // directly.
})();
```

## Change Decoding Settings

To set up the library for decoding, use the APIs `getRuntimeSettings` & `updateRuntimeSettings`.

```js
await reader.updateRuntimeSettings("speed");
```
```js
await reader.updateRuntimeSettings("balance");
```
```js
await reader.updateRuntimeSettings("coverage");
```
```js
let settings = await reader.getRuntimeSettings();
settings.localizationModes = [
    Dynamsoft.DBR.EnumLocalizationMode.LM_CONNECTED_BLOCKS,
    Dynamsoft.DBR.EnumLocalizationMode.LM_SCAN_DIRECTLY,
    Dynamsoft.DBR.EnumLocalizationMode.LM_LINES, 0, 0, 0, 0, 0];
settings.deblurLevel = 2;
await reader.updateRuntimeSettings(settings);
```

See [Barcode reading settings Guide](https://www.dynamsoft.com/barcode-reader/programming/cplusplus/user-guide.html?ver=latest#use-publicruntimesettings-struct-to-change-settings?utm_source=node&package=js) for basic usage.

See [C++ API RuntimeSettings](https://www.dynamsoft.com/barcode-reader/programming/c-cplusplus/struct/PublicRuntimeSettings.html?utm_source=node&package=js) for more details.

To find out which settings best suit your usage scenario, visit [DBR Main Online Demo](https://demo.dynamsoft.com/barcode-reader/?utm_source=node&package=js).

Any questions, please contact [Dynamsoft support](https://www.dynamsoft.com/company/contact/?utm_source=node&package=js).



## How to use the library in Node.js LTS 8

Node.js LTS 8 doesn't support `worker_threads`, so the decoding will happen in the same main thread which means it's a blocking operation. The following code snippets demonstrate the basic usage.

**Decode**

```js
var dbr = require('path/to/dist/dbr-<version>.node.wasm.js');
dbr.onRuntimeInitialized = ()=>{
    dbr.BarcodeReaderWasm.init('{"pk":"PRODUCT-KEY"}');
    var reader = new dbr.BarcodeReaderWasm(false,-1);
    var fs = require('fs');
    var img = fs.readFileSync('./sample.png');
    var resultsInfo = JSON.parse(reader.decodeFileInMemory(new Uint8Array(img)));
    console.log(resultsInfo);
};
```

**Change settings**

```js
var settings = JSON.parse(reader.getRuntimeSettings());
settings.expectedBarcodesCount = 999;
reader.updateRuntimeSettings(JSON.stringify(settings));
```





