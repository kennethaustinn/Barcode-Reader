/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Barcode Reader JS Edition
 * @website http://www.dynamsoft.com
 * @copyright Copyright 2022, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 8.8.7 (js 20220125)
 * @fileoverview Dynamsoft JavaScript Library for Barcode Reader
 * More info on DBR JS: https://www.dynamsoft.com/barcode-reader/sdk-javascript/
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).Dynamsoft=e.Dynamsoft||{},e.Dynamsoft.DBR={}))}(this,(function(e){"use strict";function t(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{_(n.next(e))}catch(e){i(e)}}function a(e){try{_(n.throw(e))}catch(e){i(e)}}function _(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}_((n=n.apply(e,t||[])).next())}))}var r,n,o,i;e.EnumImagePixelFormat=void 0,(r=e.EnumImagePixelFormat||(e.EnumImagePixelFormat={}))[r.IPF_Binary=0]="IPF_Binary",r[r.IPF_BinaryInverted=1]="IPF_BinaryInverted",r[r.IPF_GrayScaled=2]="IPF_GrayScaled",r[r.IPF_NV21=3]="IPF_NV21",r[r.IPF_RGB_565=4]="IPF_RGB_565",r[r.IPF_RGB_555=5]="IPF_RGB_555",r[r.IPF_RGB_888=6]="IPF_RGB_888",r[r.IPF_ARGB_8888=7]="IPF_ARGB_8888",r[r.IPF_RGB_161616=8]="IPF_RGB_161616",r[r.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",r[r.IPF_ABGR_8888=10]="IPF_ABGR_8888",r[r.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",r[r.IPF_BGR_888=12]="IPF_BGR_888",e.EnumErrorCode=void 0,(n=e.EnumErrorCode||(e.EnumErrorCode={}))[n.DBR_SYSTEM_EXCEPTION=1]="DBR_SYSTEM_EXCEPTION",n[n.DBR_SUCCESS=0]="DBR_SUCCESS",n[n.DBR_UNKNOWN=-1e4]="DBR_UNKNOWN",n[n.DBR_NO_MEMORY=-10001]="DBR_NO_MEMORY",n[n.DBR_NULL_REFERENCE=-10002]="DBR_NULL_REFERENCE",n[n.DBR_LICENSE_INVALID=-10003]="DBR_LICENSE_INVALID",n[n.DBR_LICENSE_EXPIRED=-10004]="DBR_LICENSE_EXPIRED",n[n.DBR_FILE_NOT_FOUND=-10005]="DBR_FILE_NOT_FOUND",n[n.DBR_FILETYPE_NOT_SUPPORTED=-10006]="DBR_FILETYPE_NOT_SUPPORTED",n[n.DBR_BPP_NOT_SUPPORTED=-10007]="DBR_BPP_NOT_SUPPORTED",n[n.DBR_INDEX_INVALID=-10008]="DBR_INDEX_INVALID",n[n.DBR_BARCODE_FORMAT_INVALID=-10009]="DBR_BARCODE_FORMAT_INVALID",n[n.DBR_CUSTOM_REGION_INVALID=-10010]="DBR_CUSTOM_REGION_INVALID",n[n.DBR_MAX_BARCODE_NUMBER_INVALID=-10011]="DBR_MAX_BARCODE_NUMBER_INVALID",n[n.DBR_IMAGE_READ_FAILED=-10012]="DBR_IMAGE_READ_FAILED",n[n.DBR_TIFF_READ_FAILED=-10013]="DBR_TIFF_READ_FAILED",n[n.DBR_QR_LICENSE_INVALID=-10016]="DBR_QR_LICENSE_INVALID",n[n.DBR_1D_LICENSE_INVALID=-10017]="DBR_1D_LICENSE_INVALID",n[n.DBR_DIB_BUFFER_INVALID=-10018]="DBR_DIB_BUFFER_INVALID",n[n.DBR_PDF417_LICENSE_INVALID=-10019]="DBR_PDF417_LICENSE_INVALID",n[n.DBR_DATAMATRIX_LICENSE_INVALID=-10020]="DBR_DATAMATRIX_LICENSE_INVALID",n[n.DBR_PDF_READ_FAILED=-10021]="DBR_PDF_READ_FAILED",n[n.DBR_PDF_DLL_MISSING=-10022]="DBR_PDF_DLL_MISSING",n[n.DBR_PAGE_NUMBER_INVALID=-10023]="DBR_PAGE_NUMBER_INVALID",n[n.DBR_CUSTOM_SIZE_INVALID=-10024]="DBR_CUSTOM_SIZE_INVALID",n[n.DBR_CUSTOM_MODULESIZE_INVALID=-10025]="DBR_CUSTOM_MODULESIZE_INVALID",n[n.DBR_RECOGNITION_TIMEOUT=-10026]="DBR_RECOGNITION_TIMEOUT",n[n.DBR_JSON_PARSE_FAILED=-10030]="DBR_JSON_PARSE_FAILED",n[n.DBR_JSON_TYPE_INVALID=-10031]="DBR_JSON_TYPE_INVALID",n[n.DBR_JSON_KEY_INVALID=-10032]="DBR_JSON_KEY_INVALID",n[n.DBR_JSON_VALUE_INVALID=-10033]="DBR_JSON_VALUE_INVALID",n[n.DBR_JSON_NAME_KEY_MISSING=-10034]="DBR_JSON_NAME_KEY_MISSING",n[n.DBR_JSON_NAME_VALUE_DUPLICATED=-10035]="DBR_JSON_NAME_VALUE_DUPLICATED",n[n.DBR_TEMPLATE_NAME_INVALID=-10036]="DBR_TEMPLATE_NAME_INVALID",n[n.DBR_JSON_NAME_REFERENCE_INVALID=-10037]="DBR_JSON_NAME_REFERENCE_INVALID",n[n.DBR_PARAMETER_VALUE_INVALID=-10038]="DBR_PARAMETER_VALUE_INVALID",n[n.DBR_DOMAIN_NOT_MATCHED=-10039]="DBR_DOMAIN_NOT_MATCHED",n[n.DBR_RESERVEDINFO_NOT_MATCHED=-10040]="DBR_RESERVEDINFO_NOT_MATCHED",n[n.DBR_AZTEC_LICENSE_INVALID=-10041]="DBR_AZTEC_LICENSE_INVALID",n[n.DBR_LICENSE_DLL_MISSING=-10042]="DBR_LICENSE_DLL_MISSING",n[n.DBR_LICENSEKEY_NOT_MATCHED=-10043]="DBR_LICENSEKEY_NOT_MATCHED",n[n.DBR_REQUESTED_FAILED=-10044]="DBR_REQUESTED_FAILED",n[n.DBR_LICENSE_INIT_FAILED=-10045]="DBR_LICENSE_INIT_FAILED",n[n.DBR_PATCHCODE_LICENSE_INVALID=-10046]="DBR_PATCHCODE_LICENSE_INVALID",n[n.DBR_POSTALCODE_LICENSE_INVALID=-10047]="DBR_POSTALCODE_LICENSE_INVALID",n[n.DBR_DPM_LICENSE_INVALID=-10048]="DBR_DPM_LICENSE_INVALID",n[n.DBR_FRAME_DECODING_THREAD_EXISTS=-10049]="DBR_FRAME_DECODING_THREAD_EXISTS",n[n.DBR_STOP_DECODING_THREAD_FAILED=-10050]="DBR_STOP_DECODING_THREAD_FAILED",n[n.DBR_SET_MODE_ARGUMENT_ERROR=-10051]="DBR_SET_MODE_ARGUMENT_ERROR",n[n.DBR_LICENSE_CONTENT_INVALID=-10052]="DBR_LICENSE_CONTENT_INVALID",n[n.DBR_LICENSE_KEY_INVALID=-10053]="DBR_LICENSE_KEY_INVALID",n[n.DBR_LICENSE_DEVICE_RUNS_OUT=-10054]="DBR_LICENSE_DEVICE_RUNS_OUT",n[n.DBR_GET_MODE_ARGUMENT_ERROR=-10055]="DBR_GET_MODE_ARGUMENT_ERROR",n[n.DBR_IRT_LICENSE_INVALID=-10056]="DBR_IRT_LICENSE_INVALID",n[n.DBR_MAXICODE_LICENSE_INVALID=-10057]="DBR_MAXICODE_LICENSE_INVALID",n[n.DBR_GS1_DATABAR_LICENSE_INVALID=-10058]="DBR_GS1_DATABAR_LICENSE_INVALID",n[n.DBR_GS1_COMPOSITE_LICENSE_INVALID=-10059]="DBR_GS1_COMPOSITE_LICENSE_INVALID",n[n.DBR_DOTCODE_LICENSE_INVALID=-10061]="DBR_DOTCODE_LICENSE_INVALID",n[n.DMERR_NO_LICENSE=-2e4]="DMERR_NO_LICENSE",n[n.DMERR_LICENSE_SYNC_FAILED=-20003]="DMERR_LICENSE_SYNC_FAILED",n[n.DMERR_TRIAL_LICENSE=-20010]="DMERR_TRIAL_LICENSE",n[n.DMERR_FAILED_TO_REACH_LTS=-20200]="DMERR_FAILED_TO_REACH_LTS",e.EnumIMResultDataType=void 0,(o=e.EnumIMResultDataType||(e.EnumIMResultDataType={}))[o.IMRDT_IMAGE=1]="IMRDT_IMAGE",o[o.IMRDT_CONTOUR=2]="IMRDT_CONTOUR",o[o.IMRDT_LINESEGMENT=4]="IMRDT_LINESEGMENT",o[o.IMRDT_LOCALIZATIONRESULT=8]="IMRDT_LOCALIZATIONRESULT",o[o.IMRDT_REGIONOFINTEREST=16]="IMRDT_REGIONOFINTEREST",o[o.IMRDT_QUADRILATERAL=32]="IMRDT_QUADRILATERAL",e.EnumBarcodeFormat=void 0,(i=e.EnumBarcodeFormat||(e.EnumBarcodeFormat={}))[i.BF_ALL=-31457281]="BF_ALL",i[i.BF_ONED=1050623]="BF_ONED",i[i.BF_GS1_DATABAR=260096]="BF_GS1_DATABAR",i[i.BF_CODE_39=1]="BF_CODE_39",i[i.BF_CODE_128=2]="BF_CODE_128",i[i.BF_CODE_93=4]="BF_CODE_93",i[i.BF_CODABAR=8]="BF_CODABAR",i[i.BF_ITF=16]="BF_ITF",i[i.BF_EAN_13=32]="BF_EAN_13",i[i.BF_EAN_8=64]="BF_EAN_8",i[i.BF_UPC_A=128]="BF_UPC_A",i[i.BF_UPC_E=256]="BF_UPC_E",i[i.BF_INDUSTRIAL_25=512]="BF_INDUSTRIAL_25",i[i.BF_CODE_39_EXTENDED=1024]="BF_CODE_39_EXTENDED",i[i.BF_GS1_DATABAR_OMNIDIRECTIONAL=2048]="BF_GS1_DATABAR_OMNIDIRECTIONAL",i[i.BF_GS1_DATABAR_TRUNCATED=4096]="BF_GS1_DATABAR_TRUNCATED",i[i.BF_GS1_DATABAR_STACKED=8192]="BF_GS1_DATABAR_STACKED",i[i.BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL=16384]="BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL",i[i.BF_GS1_DATABAR_EXPANDED=32768]="BF_GS1_DATABAR_EXPANDED",i[i.BF_GS1_DATABAR_EXPANDED_STACKED=65536]="BF_GS1_DATABAR_EXPANDED_STACKED",i[i.BF_GS1_DATABAR_LIMITED=131072]="BF_GS1_DATABAR_LIMITED",i[i.BF_PATCHCODE=262144]="BF_PATCHCODE",i[i.BF_PDF417=33554432]="BF_PDF417",i[i.BF_QR_CODE=67108864]="BF_QR_CODE",i[i.BF_DATAMATRIX=134217728]="BF_DATAMATRIX",i[i.BF_AZTEC=268435456]="BF_AZTEC",i[i.BF_MAXICODE=536870912]="BF_MAXICODE",i[i.BF_MICRO_QR=1073741824]="BF_MICRO_QR",i[i.BF_MICRO_PDF417=524288]="BF_MICRO_PDF417",i[i.BF_GS1_COMPOSITE=-2147483648]="BF_GS1_COMPOSITE",i[i.BF_MSI_CODE=1048576]="BF_MSI_CODE",i[i.BF_NULL=0]="BF_NULL";const s=!!("object"==typeof global&&global.process&&global.process.release&&global.process.release.name&&"undefined"==typeof HTMLCanvasElement),a=!s&&"undefined"==typeof self,_=s?global:a?{}:self;class d{constructor(){this._canvasMaxWH="iPhone"==d.browserInfo.OS||"Android"==d.browserInfo.OS?2048:4096,this._instanceID=void 0,this.bSaveOriCanvas=!1,this.oriCanvas=null,this.bFilterRegionInJs=!0,this._region=null,this._timeStartDecode=null,this._timeEnterInnerDBR=null,this._timeGetMessage=null,this._bUseWebgl=!0,this.decodeRecords={},this.bDestroyed=!1,this._lastErrorCode=0,this._lastErrorString="",this._lastInnerDecodeDuration=0}static get version(){return this._version}static get license(){return this._license}static set license(e){if("unload"!=this._loadWasmStatus)throw new Error("`license` is not allowed to change after `createInstance` or `loadWasm` is called.");d._license=e}static get productKeys(){return this._license}static set productKeys(e){d.license=e}static get handshakeCode(){return this._license}static set handshakeCode(e){d.license=e}static get organizationID(){return this._license}static set organizationID(e){d.license=e}static set sessionPassword(e){if("unload"!=this._loadWasmStatus)throw new Error("`sessionPassword` is not allowed to change after `createInstance` or `loadWasm` is called.");d._sessionPassword=e}static get sessionPassword(){return this._sessionPassword}static detectEnvironment(){return t(this,void 0,void 0,(function*(){let e={wasm:"undefined"!=typeof WebAssembly&&("undefined"==typeof navigator||!(/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&/\(.+\s11_2_([2-6]).*\)/.test(navigator.userAgent))),worker:!!(s?process.version>="v12":"undefined"!=typeof Worker),getUserMedia:!("undefined"==typeof navigator||!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia),camera:!1,browser:this.browserInfo.browser,version:this.browserInfo.version,OS:this.browserInfo.OS};if(e.getUserMedia)try{(yield navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach((e=>{e.stop()})),e.camera=!0}catch(e){}return e}))}static get engineResourcePath(){return this._engineResourcePath}static set engineResourcePath(e){if("unload"!=this._loadWasmStatus)throw new Error("`engineResourcePath` is not allowed to change after `createInstance` or `loadWasm` is called.");if(null==e&&(e="./"),s||a)d._engineResourcePath=e;else{let t=document.createElement("a");t.href=e,d._engineResourcePath=t.href}this._engineResourcePath.endsWith("/")||(d._engineResourcePath+="/")}static get licenseServer(){return this._licenseServer}static set licenseServer(e){if("unload"!=this._loadWasmStatus)throw new Error("`licenseServer` is not allowed to change after `createInstance` or `loadWasm` is called.");if(null==e)d._licenseServer=[];else{e instanceof Array||(e=[e]);for(let t=0;t<e.length;++t){if(!s&&!a){let r=document.createElement("a");r.href=e[t],e[t]=r.href}e[t].endsWith("/")||(e[t]+="/")}d._licenseServer=e}}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(e){if("unload"!=this._loadWasmStatus)throw new Error("`deviceFriendlyName` is not allowed to change after `createInstance` or `loadWasm` is called.");d._deviceFriendlyName=e||""}static get _bUseFullFeature(){return this.__bUseFullFeature}static set _bUseFullFeature(e){if("unload"!=this._loadWasmStatus)throw new Error("`_bUseFullFeature` is not allowed to change after `createInstance` or `loadWasm` is called.");d.__bUseFullFeature=e}get ifSaveOriginalImageInACanvas(){return this.bSaveOriCanvas}set ifSaveOriginalImageInACanvas(e){this.bSaveOriCanvas=e}getOriginalImageInACanvas(){return this.oriCanvas}set region(e){this._region=e}get region(){return this._region}static isLoaded(){return"loadSuccess"==this._loadWasmStatus}isContextDestroyed(){return this.bDestroyed}static get lastErrorCode(){return this._lastErrorCode}static get lastErrorString(){return this._lastErrorString}get lastErrorCode(){return this._lastErrorCode}get lastErrorString(){return this._lastErrorString}static loadWasm(){return t(this,void 0,void 0,(function*(){if(s&&process.version<"v12")throw new Error("DBRJS SDK requires nodejs version >= v12.");let r,n=d._license,o=JSON.parse(JSON.stringify(d._licenseServer)),i=d._sessionPassword,a=null,E=null,l=0;if(n.startsWith("t")||n.startsWith("f"))l=0;else if(0===n.length||n.startsWith("P")||n.startsWith("L"))l=1;else{l=2;const e=n.indexOf(":");if(-1!=e&&(n=n.substring(e+1)),n.startsWith("DLS2")){let e=n.substring(4);e=s?Buffer.from(e,"base64").toString("binary"):atob(e);const t=JSON.parse(e);if(t.handshakeCode?n=t.handshakeCode:t.organizationID&&(n=t.organizationID),"number"==typeof n&&(n=JSON.stringify(n)),n||(n=""),0===o.length){let e=[];t.mainServerURL&&(e[0]=t.mainServerURL),t.standbyServerURL&&(e[1]=t.standbyServerURL),d.licenseServer=e,o=d.licenseServer}!i&&t.sessionPassword&&(i=t.sessionPassword),t.chargeWay&&(E=t.chargeWay),t.limitedLicenseModules&&(a=t.limitedLicenseModules)}}if(l&&(s?process.version<"v15"&&(r="To use online key requires nodejs version >= v15."):(_.crypto||(r="Please upgrade your browser to support online key."),_.crypto.subtle||(r="Require https to use online key in this browser."))),r){if(1!==l)throw new Error(r);l=0,console.warn(r),d._lastErrorCode=e.EnumErrorCode.DMERR_FAILED_TO_REACH_LTS,d._lastErrorString=r}return 1===l&&(n="",console.warn("Automatically apply for a public trial license.")),yield new Promise(((e,r)=>t(this,void 0,void 0,(function*(){switch(d._loadWasmStatus){case"unload":{d._loadWasmStatus="loading";let e=d.engineResourcePath+d._workerName;if(s||d.engineResourcePath.startsWith(location.origin)||(e=yield fetch(e).then((e=>e.blob())).then((e=>URL.createObjectURL(e)))),s){const t=yield import("worker_threads");d._dbrWorker=new t.Worker(e)}else d._dbrWorker=new Worker(e);d._dbrWorker.onerror=e=>{d._loadWasmStatus="loadFail";let t=new Error(e.message);d._loadWasmErr=t;for(let e of d._loadWasmCallbackArr)e(t);d._loadWasmCallbackArr=[]},d._dbrWorker.onmessage=e=>t(this,void 0,void 0,(function*(){let t=e.data?e.data:e;switch(t.type){case"log":d._onLog&&d._onLog(t.message);break;case"load":{t.message&&(t.message=t.message.replace("(https://www.dynamsoft.com/purchase-center/)","(https://www.dynamsoft.com/store/dynamsoft-barcode-reader/#javascript)"));let e=!1;if(1===l&&(e=!0),t.success){d._loadWasmStatus="loadSuccess",d._version=t.version+"(JS "+d._jsVersion+"."+d._jsEditVersion+")",d._onLog&&d._onLog("load dbr worker success");for(let e of d._loadWasmCallbackArr)e();d._loadWasmCallbackArr=[],d._dbrWorker.onerror=null,t.message&&console.warn(t.message)}else{let r=new Error(t.message);r.stack=t.stack+"\n"+r.stack,d._loadWasmStatus="loadFail",d._loadWasmErr=r;for(let e of d._loadWasmCallbackArr)e(r);d._loadWasmCallbackArr=[],e||111==t.ltsErrorCode&&-1!=t.message.toLowerCase().indexOf("trial license")&&(e=!0)}e&&d.showDialog(t.success?"warn":"error",t.message);break}case"task":{let e=t.id,r=t.body;try{d._taskCallbackMap.get(e)(r),d._taskCallbackMap.delete(e)}catch(t){throw d._taskCallbackMap.delete(e),t}break}default:d._onLog&&d._onLog(e)}})),s&&d._dbrWorker.on("message",d._dbrWorker.onmessage),d._dbrWorker.postMessage({type:"loadWasm",bd:d._bWasmDebug,engineResourcePath:d.engineResourcePath,version:d._jsVersion,brtk:!!l,bptk:1===l,lcs:n,dm:!s&&location.origin.startsWith("http")?location.origin:"https://localhost",bUseFullFeature:d._bUseFullFeature,browserInfo:d.browserInfo,deviceFriendlyName:d.deviceFriendlyName,ls:o,sp:i,lm:a,cw:E})}case"loading":d._loadWasmCallbackArr.push((t=>{t?r(t):e()}));break;case"loadSuccess":e();break;case"loadFail":r(d._loadWasmErr)}}))))}))}static showDialog(e,r){return t(this,void 0,void 0,(function*(){if(!s&&!d._bNeverShowDialog)try{let t=yield fetch(d.engineResourcePath+"dls.license.dialog.html");if(!t.ok)throw Error("Get license dialog fail. Network Error: "+t.statusText);let n=yield t.text();if(!n.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let o=document.createElement("div");o.innerHTML=n;let i=[];for(let e=0;e<o.childElementCount;++e){let t=o.children[e];t instanceof HTMLStyleElement&&(i.push(t),document.head.append(t))}let s=1==o.childElementCount?o.children[0]:o;s.remove();let a,_,E,l,c,R=[s],u=s.children;for(let e of u)R.push(e);for(let e=0;e<R.length;++e)for(let t of R[e].children)R.push(t);for(let t of R)if(!a&&t.classList.contains("dls-license-mask"))a=t,t.addEventListener("click",(e=>{if(t==e.target){s.remove();for(let e of i)e.remove()}}));else if(!_&&t.classList.contains("dls-license-icon-close"))_=t,t.addEventListener("click",(()=>{s.remove();for(let e of i)e.remove()}));else if(!E&&t.classList.contains("dls-license-icon-error"))E=t,"error"!=e&&t.remove();else if(!l&&t.classList.contains("dls-license-icon-warn"))l=t,"warn"!=e&&t.remove();else if(!c&&t.classList.contains("dls-license-msg-content")){c=t;let e=r;for(;e;){let r=e.indexOf("["),n=e.indexOf("]",r),o=e.indexOf("(",n),i=e.indexOf(")",o);if(-1==r||-1==n||-1==o||-1==i){t.appendChild(new Text(e));break}r>0&&t.appendChild(new Text(e.substring(0,r)));let s=document.createElement("a"),a=e.substring(r+1,n);s.innerText=a;let _=e.substring(o+1,i);s.setAttribute("href",_),s.setAttribute("target","_blank"),t.appendChild(s),e=e.substring(i+1)}}document.body.appendChild(s)}catch(e){d._onLog&&d._onLog(e.message||e)}}))}static createInstanceInWorker(e=!1){return t(this,void 0,void 0,(function*(){return yield d.loadWasm(),yield new Promise(((t,r)=>{let n=d._nextTaskID++;d._taskCallbackMap.set(n,(e=>{if(e.success)return t(e.instanceID);{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,r(t)}})),d._dbrWorker.postMessage({type:"createInstance",id:n,bScanner:e})}))}))}static createInstance(){return t(this,void 0,void 0,(function*(){let e=new d;return e._instanceID=yield d.createInstanceInWorker(),e}))}decode(e){return t(this,void 0,void 0,(function*(){if(d._onLog&&d._onLog("decode(source: any)"),d._onLog&&(this._timeStartDecode=Date.now()),s)return e instanceof Buffer?yield this._decodeFileInMemory_Uint8Array(new Uint8Array(e)):e instanceof Uint8Array?yield this._decodeFileInMemory_Uint8Array(e):"string"==typeof e?"data:image/"==e.substring(0,11)?yield this._decode_Base64(e):"http"==e.substring(0,4)?yield this._decode_Url(e):yield this._decode_FilePath(e):yield Promise.reject(TypeError("'_decode(source, config)': Type of 'source' should be 'Buffer', 'Uint8Array', 'String(base64 with image mime)' or 'String(url)'."));{let t={};return!this.region||this.region instanceof Array||(t.region=JSON.parse(JSON.stringify(this.region))),e instanceof Blob?yield this._decode_Blob(e,t):e instanceof ArrayBuffer?yield this._decode_ArrayBuffer(e,t):e instanceof Uint8Array||e instanceof Uint8ClampedArray?yield this._decode_Uint8Array(e,t):e instanceof HTMLImageElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?yield this._decode_Image(e,t):e instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas?yield this._decode_Canvas(e,t):e instanceof HTMLVideoElement?yield this._decode_Video(e,t):"string"==typeof e?"data:image/"==e.substring(0,11)?yield this._decode_Base64(e,t):yield this._decode_Url(e,t):yield Promise.reject(TypeError("'_decode(source, config)': Type of 'source' should be 'Blob', 'ArrayBuffer', 'Uint8Array', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement', 'String(base64 with image mime)' or 'String(url)'."))}}))}decodeBase64String(e){return t(this,void 0,void 0,(function*(){let t={};return!this.region||this.region instanceof Array||(t.region=JSON.parse(JSON.stringify(this.region))),this._decode_Base64(e,t)}))}decodeUrl(e){return t(this,void 0,void 0,(function*(){let t={};return!this.region||this.region instanceof Array||(t.region=JSON.parse(JSON.stringify(this.region))),this._decode_Url(e,t)}))}_decodeBuffer_Uint8Array(e,r,n,o,i,s){return t(this,void 0,void 0,(function*(){return yield new Promise(((t,a)=>{let _=d._nextTaskID++;d._taskCallbackMap.set(_,(e=>{if(e.success){let r,n=d._onLog?Date.now():0;d._onLog&&d._onLog("worker return result: "+n),this._lastInnerDecodeDuration=e.duration;try{r=this._handleRetJsonString(e.decodeReturn)}catch(e){return a(e)}if(d._onLog){let e=Date.now();d._onLog("DBR time get result: "+n),d._onLog("Handle image cost: "+(this._timeEnterInnerDBR-this._timeStartDecode)),d._onLog("DBR worker decode image cost: "+(n-this._timeEnterInnerDBR)),d._onLog("DBR worker handle results: "+(e-n)),d._onLog("Total decode image cost: "+(e-this._timeStartDecode))}return t(r)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,a(t)}})),this._timeEnterInnerDBR=Date.now(),d._onLog&&d._onLog("Send buffer to worker:"+this._timeEnterInnerDBR),d._dbrWorker.postMessage({type:"decodeBuffer",id:_,instanceID:this._instanceID,body:{buffer:e,width:r,height:n,stride:o,format:i,config:s}},[e.buffer]),d._onLog&&s&&s._timeEndGettingFrame&&d._onLog("decode image delay: "+(this._timeEnterInnerDBR-s._timeEndGettingFrame))}))}))}_decodeBuffer_Blob(e,r,n,o,i,s){return t(this,void 0,void 0,(function*(){d._onLog&&d._onLog("_decodeBuffer_Blob(buffer,width,height,stride,format)");const t=e.arrayBuffer?yield e.arrayBuffer():yield new Promise(((t,r)=>{let n=new FileReader;n.readAsArrayBuffer(e),n.onload=()=>{t(n.result)},n.onerror=()=>{r(n.error)}}));return yield this._decodeBuffer_Uint8Array(new Uint8Array(t),r,n,o,i,s)}))}decodeBuffer(e,r,n,o,i,a){return t(this,void 0,void 0,(function*(){let t;return d._onLog&&d._onLog("decodeBuffer(buffer,width,height,stride,format)"),d._onLog&&(this._timeStartDecode=Date.now()),s?e instanceof Uint8Array?t=yield this._decodeBuffer_Uint8Array(e,r,n,o,i,a):e instanceof Buffer&&(t=yield this._decodeBuffer_Uint8Array(new Uint8Array(e),r,n,o,i,a)):e instanceof Uint8Array||e instanceof Uint8ClampedArray?t=yield this._decodeBuffer_Uint8Array(e,r,n,o,i,a):e instanceof ArrayBuffer?t=yield this._decodeBuffer_Uint8Array(new Uint8Array(e),r,n,o,i,a):e instanceof Blob&&(t=yield this._decodeBuffer_Blob(e,r,n,o,i,a)),t}))}_decodeFileInMemory_Uint8Array(e){return t(this,void 0,void 0,(function*(){return yield new Promise(((t,r)=>{let n=d._nextTaskID++;d._taskCallbackMap.set(n,(e=>{if(e.success){let n;this._lastInnerDecodeDuration=e.duration;try{n=this._handleRetJsonString(e.decodeReturn)}catch(e){return r(e)}return t(n)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,r(t)}})),d._dbrWorker.postMessage({type:"decodeFileInMemory",id:n,instanceID:this._instanceID,body:{bytes:e}})}))}))}getRuntimeSettings(){return t(this,void 0,void 0,(function*(){return yield new Promise(((e,t)=>{let r=d._nextTaskID++;d._taskCallbackMap.set(r,(r=>{if(r.success){let t=JSON.parse(r.results);return null!=this.userDefinedRegion&&(t.region=JSON.parse(JSON.stringify(this.userDefinedRegion))),e(t)}{let e=new Error(r.message);return e.stack=r.stack+"\n"+e.stack,t(e)}})),d._dbrWorker.postMessage({type:"getRuntimeSettings",id:r,instanceID:this._instanceID})}))}))}updateRuntimeSettings(r){return t(this,void 0,void 0,(function*(){let t;if("string"==typeof r)if("speed"==r){let e=yield this.getRuntimeSettings();yield this.resetRuntimeSettings(),t=yield this.getRuntimeSettings(),t.barcodeFormatIds=e.barcodeFormatIds,t.barcodeFormatIds_2=e.barcodeFormatIds_2,t.region=e.region,t.deblurLevel=3,t.expectedBarcodesCount=0,t.localizationModes=[2,0,0,0,0,0,0,0]}else if("balance"==r){let e=yield this.getRuntimeSettings();yield this.resetRuntimeSettings(),t=yield this.getRuntimeSettings(),t.barcodeFormatIds=e.barcodeFormatIds,t.barcodeFormatIds_2=e.barcodeFormatIds_2,t.region=e.region,t.deblurLevel=5,t.expectedBarcodesCount=512,t.localizationModes=[2,16,0,0,0,0,0,0]}else if("coverage"==r){let e=yield this.getRuntimeSettings();yield this.resetRuntimeSettings(),t=yield this.getRuntimeSettings(),t.barcodeFormatIds=e.barcodeFormatIds,t.barcodeFormatIds_2=e.barcodeFormatIds_2,t.region=e.region}else t=JSON.parse(r);else{if("object"!=typeof r)throw TypeError("'UpdateRuntimeSettings(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");if(t=JSON.parse(JSON.stringify(r)),t.region instanceof Array){let e=t.region;[e.regionLeft,e.regionTop,e.regionLeft,e.regionBottom,e.regionMeasuredByPercentage].some((e=>void 0!==e))&&(t.region={regionLeft:e.regionLeft||0,regionTop:e.regionTop||0,regionRight:e.regionRight||0,regionBottom:e.regionBottom||0,regionMeasuredByPercentage:e.regionMeasuredByPercentage||0})}}if(!d._bUseFullFeature){if(0!=(t.barcodeFormatIds&~(e.EnumBarcodeFormat.BF_ONED|e.EnumBarcodeFormat.BF_QR_CODE|e.EnumBarcodeFormat.BF_PDF417|e.EnumBarcodeFormat.BF_DATAMATRIX))||0!=t.barcodeFormatIds_2)throw Error("Some of the specified barcode formats are not supported in the compact version. Please try the full-featured version.");if(0!=t.intermediateResultTypes)throw Error("Intermediate results is not supported in the compact version. Please try the full-featured version.")}if(!s)if(this.bFilterRegionInJs){let e=t.region;if(e instanceof Array)throw Error("The `region` of type `Array` is only allowed in `BarcodeScanner`.");this.userDefinedRegion=JSON.parse(JSON.stringify(e)),(e.regionLeft||e.regionTop||e.regionRight||e.regionBottom||e.regionMeasuredByPercentage)&&(e.regionLeft||e.regionTop||100!=e.regionRight||100!=e.regionBottom||!e.regionMeasuredByPercentage)?this.region=e:this.region=null,t.region={regionLeft:0,regionTop:0,regionRight:0,regionBottom:0,regionMeasuredByPercentage:0}}else this.userDefinedRegion=null,this.region=null;return yield new Promise(((e,r)=>{let n=d._nextTaskID++;d._taskCallbackMap.set(n,(t=>{if(t.success){try{this._handleRetJsonString(t.updateReturn)}catch(e){r(e)}return e()}{let e=new Error(t.message);return e.stack=t.stack+"\n"+e.stack,r(e)}})),d._dbrWorker.postMessage({type:"updateRuntimeSettings",id:n,instanceID:this._instanceID,body:{settings:JSON.stringify(t)}})}))}))}resetRuntimeSettings(){return t(this,void 0,void 0,(function*(){return this.userDefinedRegion=null,this.region=null,yield new Promise(((e,t)=>{let r=d._nextTaskID++;d._taskCallbackMap.set(r,(r=>{if(r.success)return e();{let e=new Error(r.message);return e.stack=r.stack+"\n"+e.stack,t(e)}})),d._dbrWorker.postMessage({type:"resetRuntimeSettings",id:r,instanceID:this._instanceID})}))}))}outputSettingsToString(){return t(this,void 0,void 0,(function*(){if(!d._bUseFullFeature)throw Error("outputSettingsToString() is not supported in the compact version. Please try the full-featured version.");return yield new Promise(((e,t)=>{let r=d._nextTaskID++;d._taskCallbackMap.set(r,(r=>{if(r.success)return e(r.results);{let e=new Error(r.message);return e.stack=r.stack+"\n"+e.stack,t(e)}})),d._dbrWorker.postMessage({type:"outputSettingsToString",id:r,instanceID:this._instanceID})}))}))}initRuntimeSettingsWithString(e){return t(this,void 0,void 0,(function*(){if(!d._bUseFullFeature)throw Error("initRuntimeSettingsWithString() is not supported in the compact version. Please try the full-featured version.");if("string"==typeof e)e=e;else{if("object"!=typeof e)throw TypeError("'initRuntimeSettingstWithString(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");e=JSON.stringify(e)}return yield new Promise(((t,r)=>{let n=d._nextTaskID++;d._taskCallbackMap.set(n,(e=>{if(e.success){try{this._handleRetJsonString(e.initReturn)}catch(e){r(e)}return t()}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,r(t)}})),d._dbrWorker.postMessage({type:"initRuntimeSettingsWithString",id:n,instanceID:this._instanceID,body:{settings:e}})}))}))}_decode_Blob(e,r){return t(this,void 0,void 0,(function*(){d._onLog&&d._onLog("_decode_Blob(blob: Blob)");let t=null,n=null;if("undefined"!=typeof createImageBitmap)try{t=yield createImageBitmap(e)}catch(e){}t||(n=yield function(e){return new Promise(((t,r)=>{let n=URL.createObjectURL(e),o=new Image;o.dbrObjUrl=n,o.src=n,o.onload=()=>{t(o)},o.onerror=e=>{r(new Error("Can't convert blob to image : "+(e instanceof Event?e.type:e)))}}))}(e));let o=yield this._decode_Image(t||n,r);return t&&t.close(),o}))}_decode_ArrayBuffer(e,r){return t(this,void 0,void 0,(function*(){return yield this._decode_Blob(new Blob([e]),r)}))}_decode_Uint8Array(e,r){return t(this,void 0,void 0,(function*(){return yield this._decode_Blob(new Blob([e]),r)}))}_decode_Image(e,r){return t(this,void 0,void 0,(function*(){d._onLog&&d._onLog("_decode_Image(image: HTMLImageElement|ImageBitmap)"),r=r||{};let t,n,o,i,s=e instanceof HTMLImageElement?e.naturalWidth:e.width,a=e instanceof HTMLImageElement?e.naturalHeight:e.height,E=r.region;if(E){let e,r,o,i;E.regionMeasuredByPercentage?(e=E.regionLeft*s/100,r=E.regionTop*a/100,o=E.regionRight*s/100,i=E.regionBottom*a/100):(e=E.regionLeft,r=E.regionTop,o=E.regionRight,i=E.regionBottom),t=e,n=r,s=Math.round(o-e),a=Math.round(i-r)}else t=0,n=0;const l=Math.max(s,a);if(l>this._canvasMaxWH){const e=this._canvasMaxWH/l;s>a?(o=this._canvasMaxWH,i=Math.round(a*e)):(o=Math.round(s*e),i=this._canvasMaxWH)}else o=s,i=a;let c,R;!this.bSaveOriCanvas&&_.OffscreenCanvas?c=new OffscreenCanvas(o,i):(c=document.createElement("canvas"),c.width=o,c.height=i),c.getContext("2d").drawImage(e,t,n,s,a,0,0,o,i),e.dbrObjUrl&&URL.revokeObjectURL(e.dbrObjUrl),E?(R=JSON.parse(JSON.stringify(r)),delete R.region):R=r;let u=yield this._decode_Canvas(c,R);return d.fixResultLocationWhenFilterRegionInJs(E,u,t,n,s,a,o,i),u}))}_decode_Canvas(r,n){return t(this,void 0,void 0,(function*(){if(d._onLog&&d._onLog("_decode_Canvas(canvas:HTMLCanvasElement)"),r.crossOrigin&&"anonymous"!=r.crossOrigin)throw"cors";(this.bSaveOriCanvas||this.singleFrameMode)&&(this.oriCanvas=r);let t=(r.dbrCtx2d||r.getContext("2d")).getImageData(0,0,r.width,r.height).data;return yield this._decodeBuffer_Uint8Array(t,r.width,r.height,4*r.width,e.EnumImagePixelFormat.IPF_ABGR_8888,n)}))}_decode_Video(e,r){return t(this,void 0,void 0,(function*(){if(d._onLog&&d._onLog("_decode_Video(video)"),!(e instanceof HTMLVideoElement))throw TypeError("'_decode_Video(video [, config] )': Type of 'video' should be 'HTMLVideoElement'.");if(e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";r=r||{};let t,n,o,i,s=e.videoWidth,a=e.videoHeight,E=r.region;if(E){let e,r,o,i;E.regionMeasuredByPercentage?(e=E.regionLeft*s/100,r=E.regionTop*a/100,o=E.regionRight*s/100,i=E.regionBottom*a/100):(e=E.regionLeft,r=E.regionTop,o=E.regionRight,i=E.regionBottom),t=e,n=r,s=Math.round(o-e),a=Math.round(i-r)}else t=0,n=0;const l=Math.max(s,a);if(l>this._canvasMaxWH){const e=this._canvasMaxWH/l;s>a?(o=this._canvasMaxWH,i=Math.round(a*e)):(o=Math.round(s*e),i=this._canvasMaxWH)}else o=s,i=a;let c=null;!this.bSaveOriCanvas&&_.OffscreenCanvas?c=new OffscreenCanvas(o,i):(c=document.createElement("canvas"),c.width=o,c.height=i);let R;(c.dbrCtx2d=c.getContext("2d")).drawImage(e,t,n,s,a,0,0,o,i),E?(R=JSON.parse(JSON.stringify(r)),delete R.region):R=r;let u=yield this._decode_Canvas(c,r);return E&&d.fixResultLocationWhenFilterRegionInJs(E,u,t,n,s,a,o,i),u}))}_decode_Base64(e,r){return t(this,void 0,void 0,(function*(){if(d._onLog&&d._onLog("_decode_Base64(base64Str)"),"string"!=typeof e)return Promise.reject("'_decode_Base64(base64Str, config)': Type of 'base64Str' should be 'string'.");if("data:image/"==e.substring(0,11)&&(e=e.substring(e.indexOf(",")+1)),s){let t=Buffer.from(e,"base64");return yield this._decodeFileInMemory_Uint8Array(new Uint8Array(t))}{let t=atob(e),n=t.length,o=new Uint8Array(n);for(;n--;)o[n]=t.charCodeAt(n);return yield this._decode_Blob(new Blob([o]),r)}}))}_decode_Url(e,r){return t(this,void 0,void 0,(function*(){if(d._onLog&&d._onLog("_decode_Url(url)"),"string"!=typeof e)throw TypeError("'_decode_Url(url, config)': Type of 'url' should be 'string'.");if(e=e,s){let r=yield new Promise(((r,n)=>t(this,void 0,void 0,(function*(){(e.startsWith("https")?yield import("https"):yield import("http")).get(e,(e=>{if(200==e.statusCode){let t=[];e.on("data",(e=>{t.push(e)})).on("end",(()=>{r(new Uint8Array(Buffer.concat(t)))}))}else n("http get fail, statusCode: "+e.statusCode)}))}))));return yield this._decodeFileInMemory_Uint8Array(r)}{let n=yield new Promise(((r,n)=>{let o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="blob",o.send(),o.onloadend=()=>t(this,void 0,void 0,(function*(){r(o.response)})),o.onerror=()=>{n(new Error("Network Error: "+o.statusText))}}));return yield this._decode_Blob(n,r)}}))}_decode_FilePath(e,r){return t(this,void 0,void 0,(function*(){if(d._onLog&&d._onLog("_decode_FilePath(path)"),!s)throw Error("'_decode_FilePath(path, config)': The method is only supported in node environment.");if("string"!=typeof e)throw TypeError("'_decode_FilePath(path, config)': Type of 'path' should be 'string'.");const t=yield import("fs");let r=yield new Promise(((r,n)=>{t.readFile(e,((e,t)=>{e?n(e):r(new Uint8Array(t))}))}));return yield this._decodeFileInMemory_Uint8Array(r)}))}static fixResultLocationWhenFilterRegionInJs(e,t,r,n,o,i,s,a){if(e&&t.length>0)for(let e of t){let t=e.localizationResult;2==t.resultCoordinateType&&(t.x1*=.01*s,t.x2*=.01*s,t.x3*=.01*s,t.x4*=.01*s,t.y1*=.01*a,t.y2*=.01*a,t.y3*=.01*a,t.y4*=.01*a);let _=s/o,d=a/i;t.x1=t.x1/_+r,t.x2=t.x2/_+r,t.x3=t.x3/_+r,t.x4=t.x4/_+r,t.y1=t.y1/d+n,t.y2=t.y2/d+n,t.y3=t.y3/d+n,t.y4=t.y4/d+n,2==t.resultCoordinateType&&(t.x1*=100/o,t.x2*=100/o,t.x3*=100/o,t.x4*=100/o,t.y1*=100/i,t.y2*=100/i,t.y3*=100/i,t.y4*=100/i)}}static BarcodeReaderException(t,r){let n,o=e.EnumErrorCode.DBR_UNKNOWN;return"number"==typeof t?(o=t,n=new Error(r)):n=new Error(t),n.code=o,n}_handleRetJsonString(t){let r=e.EnumErrorCode;if(t.textResults){for(let e=0;e<t.textResults.length;e++){let r=t.textResults[e];try{let e=r.barcodeText,t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);try{r.barcodeText=decodeURIComponent(escape(t))}catch(e){r.barcodeText=t}}catch(e){r.barcodeText=""}if(null!=r.exception){d._setWarnnedEx.has(r.exception)||(d._setWarnnedEx.add(r.exception),console.warn(r.exception));let e={};r.exception.split(";").forEach((t=>{let r=t.indexOf(":");e[t.substring(0,r)]=t.substring(r+1)})),r.exception=e}}return t.decodeRecords?this.decodeRecords=t.decodeRecords:this.decodeRecords={},this._lastErrorCode=t.exception,this._lastErrorString=t.description,t.exception&&!d._setWarnnedEx.has(t.description)&&(d._setWarnnedEx.add(t.description),console.warn(t.description)),t.textResults}if(t.exception==r.DBR_SUCCESS)return t.data;throw d.BarcodeReaderException(t.exception,t.description)}setModeArgument(e,r,n,o){return t(this,void 0,void 0,(function*(){return yield new Promise(((t,i)=>{let s=d._nextTaskID++;d._taskCallbackMap.set(s,(e=>{if(e.success){try{this._handleRetJsonString(e.setReturn)}catch(e){return i(e)}return t()}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)}})),d._dbrWorker.postMessage({type:"setModeArgument",id:s,instanceID:this._instanceID,body:{modeName:e,index:r,argumentName:n,argumentValue:o}})}))}))}getModeArgument(e,r,n){return t(this,void 0,void 0,(function*(){return yield new Promise(((t,o)=>{let i=d._nextTaskID++;d._taskCallbackMap.set(i,(e=>{if(e.success){let r;try{r=this._handleRetJsonString(e.getReturn)}catch(e){return o(e)}return t(r)}{let t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,o(t)}})),d._dbrWorker.postMessage({type:"getModeArgument",id:i,instanceID:this._instanceID,body:{modeName:e,index:r,argumentName:n}})}))}))}getIntermediateResults(){return t(this,void 0,void 0,(function*(){return yield new Promise(((e,t)=>{let r=d._nextTaskID++;d._taskCallbackMap.set(r,(r=>{if(r.success)return e(r.results);{let e=new Error(r.message);return e.stack=r.stack+"\n"+e.stack,t(e)}})),d._dbrWorker.postMessage({type:"getIntermediateResults",id:r,instanceID:this._instanceID})}))}))}getIntermediateCanvas(){return t(this,void 0,void 0,(function*(){let t=yield this.getIntermediateResults(),r=[];for(let n of t)if(n.dataType==e.EnumIMResultDataType.IMRDT_IMAGE)for(let t of n.results){const n=t.bytes;let o;switch(d._onLog&&d._onLog(" "+n.length+" "+n.byteLength+" "+t.width+" "+t.height+" "+t.stride+" "+t.format),t.format){case e.EnumImagePixelFormat.IPF_ABGR_8888:o=new Uint8ClampedArray(n);break;case e.EnumImagePixelFormat.IPF_RGB_888:{const e=n.length/3;o=new Uint8ClampedArray(4*e);for(let t=0;t<e;++t)o[4*t]=n[3*t+2],o[4*t+1]=n[3*t+1],o[4*t+2]=n[3*t],o[4*t+3]=255;break}case e.EnumImagePixelFormat.IPF_GrayScaled:{const e=n.length;o=new Uint8ClampedArray(4*e);for(let t=0;t<e;t++)o[4*t]=o[4*t+1]=o[4*t+2]=n[t],o[4*t+3]=255;break}case e.EnumImagePixelFormat.IPF_Binary:case e.EnumImagePixelFormat.IPF_BinaryInverted:{t.width=8*t.stride,t.height=n.length/t.stride;const e=n.length;o=new Uint8ClampedArray(8*e*4);for(let t=0;t<e;t++){let e=n[t];for(let r=0;r<8;++r)o[4*(8*t+r)]=o[4*(8*t+r)+1]=o[4*(8*t+r)+2]=(128&e)/128*255,o[4*(8*t+r)+3]=255,e<<=1}break}default:console.warn("unknow intermediate image",t)}if(!o)continue;let i=new ImageData(o,t.width,t.height),s=document.createElement("canvas");s.width=t.width,s.height=t.height,s.getContext("2d").putImageData(i,0,0),r.push(s)}return r}))}destroy(){return this.destroyContext()}destroyContext(){if(d._onLog&&d._onLog("destroyContext()"),!this.bDestroyed)return this.bDestroyed=!0,new Promise(((e,t)=>{let r=d._nextTaskID++;d._taskCallbackMap.set(r,(r=>{if(r.success)return e();{let e=new Error(r.message);return e.stack=r.stack+"\n"+e.stack,t(e)}})),d._dbrWorker.postMessage({type:"destroyContext",id:r,instanceID:this._instanceID})}))}}var E,l,c,R,u,I,D,g,T,m,M,A,C,S,h,N,O,f,L,B,y,P,F,v,p,b,w;d._jsVersion="8.8.7",d._jsEditVersion="20220125",d._version="loading...(JS "+d._jsVersion+"."+d._jsEditVersion+")",d._license=s||a||!document.currentScript?"":document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID")||"",d._sessionPassword=s||a||!document.currentScript?"":document.currentScript.getAttribute("data-sessionPassword")||"",d.browserInfo=function(){if(!s&&!a){var e={init:function(){this.browser=this.searchString(this.dataBrowser)||"unknownBrowser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"unknownVersion",this.OS=this.searchString(this.dataOS)||"unknownOS","Linux"==this.OS&&-1!=navigator.userAgent.indexOf("Windows NT")&&(this.OS="HarmonyOS")},searchString:function(e){for(var t=0;t<e.length;t++){var r=e[t].string,n=e[t].prop;if(this.versionSearchString=e[t].versionSearch||e[t].identity,r){if(-1!=r.indexOf(e[t].subString))return e[t].identity}else if(n)return e[t].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(-1!=t)return parseFloat(e.substring(t+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Edge",identity:"Edge"},{string:navigator.userAgent,subString:"OPR",identity:"OPR"},{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"}],dataOS:[{string:navigator.userAgent,subString:"HarmonyOS",identity:"HarmonyOS"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone"},{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};return e.init(),{browser:e.browser,version:e.version,OS:e.OS}}if(a)return{browser:"ssr",version:0,OS:"ssr"};if(s){const e={browser:"node",version:process.version.substring(1),OS:"loading"};return(()=>{t(this,void 0,void 0,(function*(){const t=yield import("os");e.OS=t&&t.platform?t.platform()+t.release():"Unknown"}))})(),e}}(),d._workerName="dbr-"+d._jsVersion+".worker.js",d._engineResourcePath=(()=>{if(s)return __dirname+"/";if(!a&&document.currentScript){let e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{let t=e.indexOf("#");-1!=t&&(e=e.substring(0,t))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"})(),d._licenseServer=[],d._deviceFriendlyName="",d._isShowRelDecodeTimeInResults=!1,d._bWasmDebug=!1,d._bNeverShowDialog=!1,d.__bUseFullFeature=!0,d._nextTaskID=0,d._taskCallbackMap=new Map,d._loadWasmStatus="unload",d._loadWasmCallbackArr=[],d._lastErrorCode=0,d._lastErrorString="",d._setWarnnedEx=new Set,d._loadWasmErr=null,e.EnumBarcodeColourMode=void 0,(E=e.EnumBarcodeColourMode||(e.EnumBarcodeColourMode={}))[E.BICM_DARK_ON_LIGHT=1]="BICM_DARK_ON_LIGHT",E[E.BICM_LIGHT_ON_DARK=2]="BICM_LIGHT_ON_DARK",E[E.BICM_DARK_ON_DARK=4]="BICM_DARK_ON_DARK",E[E.BICM_LIGHT_ON_LIGHT=8]="BICM_LIGHT_ON_LIGHT",E[E.BICM_DARK_LIGHT_MIXED=16]="BICM_DARK_LIGHT_MIXED",E[E.BICM_DARK_ON_LIGHT_DARK_SURROUNDING=32]="BICM_DARK_ON_LIGHT_DARK_SURROUNDING",E[E.BICM_SKIP=0]="BICM_SKIP",E[E.BICM_REV=2147483648]="BICM_REV",e.EnumBarcodeComplementMode=void 0,(l=e.EnumBarcodeComplementMode||(e.EnumBarcodeComplementMode={}))[l.BCM_AUTO=1]="BCM_AUTO",l[l.BCM_GENERAL=2]="BCM_GENERAL",l[l.BCM_SKIP=0]="BCM_SKIP",l[l.BCM_REV=2147483648]="BCM_REV",e.EnumBarcodeFormat_2=void 0,(c=e.EnumBarcodeFormat_2||(e.EnumBarcodeFormat_2={}))[c.BF2_NULL=0]="BF2_NULL",c[c.BF2_POSTALCODE=32505856]="BF2_POSTALCODE",c[c.BF2_NONSTANDARD_BARCODE=1]="BF2_NONSTANDARD_BARCODE",c[c.BF2_USPSINTELLIGENTMAIL=1048576]="BF2_USPSINTELLIGENTMAIL",c[c.BF2_POSTNET=2097152]="BF2_POSTNET",c[c.BF2_PLANET=4194304]="BF2_PLANET",c[c.BF2_AUSTRALIANPOST=8388608]="BF2_AUSTRALIANPOST",c[c.BF2_RM4SCC=16777216]="BF2_RM4SCC",c[c.BF2_DOTCODE=2]="BF2_DOTCODE",e.EnumBinarizationMode=void 0,(R=e.EnumBinarizationMode||(e.EnumBinarizationMode={}))[R.BM_AUTO=1]="BM_AUTO",R[R.BM_LOCAL_BLOCK=2]="BM_LOCAL_BLOCK",R[R.BM_SKIP=0]="BM_SKIP",R[R.BM_THRESHOLD=4]="BM_THRESHOLD",R[R.BM_REV=2147483648]="BM_REV",e.EnumClarityCalculationMethod=void 0,(u=e.EnumClarityCalculationMethod||(e.EnumClarityCalculationMethod={}))[u.ECCM_CONTRAST=1]="ECCM_CONTRAST",e.EnumClarityFilterMode=void 0,(I=e.EnumClarityFilterMode||(e.EnumClarityFilterMode={}))[I.CFM_GENERAL=1]="CFM_GENERAL",e.EnumColourClusteringMode=void 0,(D=e.EnumColourClusteringMode||(e.EnumColourClusteringMode={}))[D.CCM_AUTO=1]="CCM_AUTO",D[D.CCM_GENERAL_HSV=2]="CCM_GENERAL_HSV",D[D.CCM_SKIP=0]="CCM_SKIP",D[D.CCM_REV=2147483648]="CCM_REV",e.EnumColourConversionMode=void 0,(g=e.EnumColourConversionMode||(e.EnumColourConversionMode={}))[g.CICM_GENERAL=1]="CICM_GENERAL",g[g.CICM_SKIP=0]="CICM_SKIP",g[g.CICM_REV=2147483648]="CICM_REV",e.EnumConflictMode=void 0,(T=e.EnumConflictMode||(e.EnumConflictMode={}))[T.CM_IGNORE=1]="CM_IGNORE",T[T.CM_OVERWRITE=2]="CM_OVERWRITE",e.EnumDeblurMode=void 0,(m=e.EnumDeblurMode||(e.EnumDeblurMode={}))[m.DM_SKIP=0]="DM_SKIP",m[m.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",m[m.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",m[m.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",m[m.DM_SMOOTHING=8]="DM_SMOOTHING",m[m.DM_MORPHING=16]="DM_MORPHING",m[m.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",m[m.DM_SHARPENING=64]="DM_SHARPENING",m[m.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",m[m.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING",e.EnumDeformationResistingMode=void 0,(M=e.EnumDeformationResistingMode||(e.EnumDeformationResistingMode={}))[M.DRM_AUTO=1]="DRM_AUTO",M[M.DRM_GENERAL=2]="DRM_GENERAL",M[M.DRM_SKIP=0]="DRM_SKIP",M[M.DRM_REV=2147483648]="DRM_REV",e.EnumDPMCodeReadingMode=void 0,(A=e.EnumDPMCodeReadingMode||(e.EnumDPMCodeReadingMode={}))[A.DPMCRM_AUTO=1]="DPMCRM_AUTO",A[A.DPMCRM_GENERAL=2]="DPMCRM_GENERAL",A[A.DPMCRM_SKIP=0]="DPMCRM_SKIP",A[A.DPMCRM_REV=2147483648]="DPMCRM_REV",e.EnumGrayscaleTransformationMode=void 0,(C=e.EnumGrayscaleTransformationMode||(e.EnumGrayscaleTransformationMode={}))[C.GTM_INVERTED=1]="GTM_INVERTED",C[C.GTM_ORIGINAL=2]="GTM_ORIGINAL",C[C.GTM_SKIP=0]="GTM_SKIP",C[C.GTM_REV=2147483648]="GTM_REV",e.EnumImagePreprocessingMode=void 0,(S=e.EnumImagePreprocessingMode||(e.EnumImagePreprocessingMode={}))[S.IPM_AUTO=1]="IPM_AUTO",S[S.IPM_GENERAL=2]="IPM_GENERAL",S[S.IPM_GRAY_EQUALIZE=4]="IPM_GRAY_EQUALIZE",S[S.IPM_GRAY_SMOOTH=8]="IPM_GRAY_SMOOTH",S[S.IPM_SHARPEN_SMOOTH=16]="IPM_SHARPEN_SMOOTH",S[S.IPM_MORPHOLOGY=32]="IPM_MORPHOLOGY",S[S.IPM_SKIP=0]="IPM_SKIP",S[S.IPM_REV=2147483648]="IPM_REV",e.EnumIntermediateResultSavingMode=void 0,(h=e.EnumIntermediateResultSavingMode||(e.EnumIntermediateResultSavingMode={}))[h.IRSM_MEMORY=1]="IRSM_MEMORY",h[h.IRSM_FILESYSTEM=2]="IRSM_FILESYSTEM",h[h.IRSM_BOTH=4]="IRSM_BOTH",e.EnumIntermediateResultType=void 0,(N=e.EnumIntermediateResultType||(e.EnumIntermediateResultType={}))[N.IRT_NO_RESULT=0]="IRT_NO_RESULT",N[N.IRT_ORIGINAL_IMAGE=1]="IRT_ORIGINAL_IMAGE",N[N.IRT_COLOUR_CLUSTERED_IMAGE=2]="IRT_COLOUR_CLUSTERED_IMAGE",N[N.IRT_COLOUR_CONVERTED_GRAYSCALE_IMAGE=4]="IRT_COLOUR_CONVERTED_GRAYSCALE_IMAGE",N[N.IRT_TRANSFORMED_GRAYSCALE_IMAGE=8]="IRT_TRANSFORMED_GRAYSCALE_IMAGE",N[N.IRT_PREDETECTED_REGION=16]="IRT_PREDETECTED_REGION",N[N.IRT_PREPROCESSED_IMAGE=32]="IRT_PREPROCESSED_IMAGE",N[N.IRT_BINARIZED_IMAGE=64]="IRT_BINARIZED_IMAGE",N[N.IRT_TEXT_ZONE=128]="IRT_TEXT_ZONE",N[N.IRT_CONTOUR=256]="IRT_CONTOUR",N[N.IRT_LINE_SEGMENT=512]="IRT_LINE_SEGMENT",N[N.IRT_FORM=1024]="IRT_FORM",N[N.IRT_SEGMENTATION_BLOCK=2048]="IRT_SEGMENTATION_BLOCK",N[N.IRT_TYPED_BARCODE_ZONE=4096]="IRT_TYPED_BARCODE_ZONE",N[N.IRT_PREDETECTED_QUADRILATERAL=8192]="IRT_PREDETECTED_QUADRILATERAL",e.EnumLocalizationMode=void 0,(O=e.EnumLocalizationMode||(e.EnumLocalizationMode={}))[O.LM_SKIP=0]="LM_SKIP",O[O.LM_AUTO=1]="LM_AUTO",O[O.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",O[O.LM_LINES=8]="LM_LINES",O[O.LM_STATISTICS=4]="LM_STATISTICS",O[O.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",O[O.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",O[O.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",O[O.LM_CENTRE=128]="LM_CENTRE",O[O.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",O[O.LM_REV=2147483648]="LM_REV",e.EnumPDFReadingMode=void 0,(f=e.EnumPDFReadingMode||(e.EnumPDFReadingMode={}))[f.PDFRM_RASTER=1]="PDFRM_RASTER",f[f.PDFRM_AUTO=2]="PDFRM_AUTO",f[f.PDFRM_VECTOR=4]="PDFRM_VECTOR",f[f.PDFRM_REV=2147483648]="PDFRM_REV",e.EnumQRCodeErrorCorrectionLevel=void 0,(L=e.EnumQRCodeErrorCorrectionLevel||(e.EnumQRCodeErrorCorrectionLevel={}))[L.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",L[L.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",L[L.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",L[L.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q",e.EnumRegionPredetectionMode=void 0,(B=e.EnumRegionPredetectionMode||(e.EnumRegionPredetectionMode={}))[B.RPM_AUTO=1]="RPM_AUTO",B[B.RPM_GENERAL=2]="RPM_GENERAL",B[B.RPM_GENERAL_RGB_CONTRAST=4]="RPM_GENERAL_RGB_CONTRAST",B[B.RPM_GENERAL_GRAY_CONTRAST=8]="RPM_GENERAL_GRAY_CONTRAST",B[B.RPM_GENERAL_HSV_CONTRAST=16]="RPM_GENERAL_HSV_CONTRAST",B[B.RPM_SKIP=0]="RPM_SKIP",B[B.RPM_REV=2147483648]="RPM_REV",e.EnumResultCoordinateType=void 0,(y=e.EnumResultCoordinateType||(e.EnumResultCoordinateType={}))[y.RCT_PIXEL=1]="RCT_PIXEL",y[y.RCT_PERCENTAGE=2]="RCT_PERCENTAGE",e.EnumResultType=void 0,(P=e.EnumResultType||(e.EnumResultType={}))[P.RT_STANDARD_TEXT=0]="RT_STANDARD_TEXT",P[P.RT_RAW_TEXT=1]="RT_RAW_TEXT",P[P.RT_CANDIDATE_TEXT=2]="RT_CANDIDATE_TEXT",P[P.RT_PARTIAL_TEXT=3]="RT_PARTIAL_TEXT",e.EnumScaleUpMode=void 0,(F=e.EnumScaleUpMode||(e.EnumScaleUpMode={}))[F.SUM_AUTO=1]="SUM_AUTO",F[F.SUM_LINEAR_INTERPOLATION=2]="SUM_LINEAR_INTERPOLATION",F[F.SUM_NEAREST_NEIGHBOUR_INTERPOLATION=4]="SUM_NEAREST_NEIGHBOUR_INTERPOLATION",F[F.SUM_SKIP=0]="SUM_SKIP",F[F.SUM_REV=2147483648]="SUM_REV",e.EnumTerminatePhase=void 0,(v=e.EnumTerminatePhase||(e.EnumTerminatePhase={}))[v.TP_REGION_PREDETECTED=1]="TP_REGION_PREDETECTED",v[v.TP_IMAGE_PREPROCESSED=2]="TP_IMAGE_PREPROCESSED",v[v.TP_IMAGE_BINARIZED=4]="TP_IMAGE_BINARIZED",v[v.TP_BARCODE_LOCALIZED=8]="TP_BARCODE_LOCALIZED",v[v.TP_BARCODE_TYPE_DETERMINED=16]="TP_BARCODE_TYPE_DETERMINED",v[v.TP_BARCODE_RECOGNIZED=32]="TP_BARCODE_RECOGNIZED",e.EnumTextFilterMode=void 0,(p=e.EnumTextFilterMode||(e.EnumTextFilterMode={}))[p.TFM_AUTO=1]="TFM_AUTO",p[p.TFM_GENERAL_CONTOUR=2]="TFM_GENERAL_CONTOUR",p[p.TFM_SKIP=0]="TFM_SKIP",p[p.TFM_REV=2147483648]="TFM_REV",e.EnumTextResultOrderMode=void 0,(b=e.EnumTextResultOrderMode||(e.EnumTextResultOrderMode={}))[b.TROM_CONFIDENCE=1]="TROM_CONFIDENCE",b[b.TROM_POSITION=2]="TROM_POSITION",b[b.TROM_FORMAT=4]="TROM_FORMAT",b[b.TROM_SKIP=0]="TROM_SKIP",b[b.TROM_REV=2147483648]="TROM_REV",e.EnumTextureDetectionMode=void 0,(w=e.EnumTextureDetectionMode||(e.EnumTextureDetectionMode={}))[w.TDM_AUTO=1]="TDM_AUTO",w[w.TDM_GENERAL_WIDTH_CONCENTRATION=2]="TDM_GENERAL_WIDTH_CONCENTRATION",w[w.TDM_SKIP=0]="TDM_SKIP",w[w.TDM_REV=2147483648]="TDM_REV";class U{static get version(){return d.version}static get productKeys(){return d.productKeys}static set productKeys(e){d.productKeys=e}static get handshakeCode(){return d.handshakeCode}static set handshakeCode(e){d.handshakeCode=e}static get organizationID(){return d.organizationID}static set organizationID(e){d.organizationID=e}static get sessionPassword(){return d.sessionPassword}static set sessionPassword(e){d.sessionPassword=e}static get browserInfo(){return d.browserInfo}static detectEnvironment(){return d.detectEnvironment()}static get _workerName(){return d._workerName}static set _workerName(e){d._workerName=e}static get engineResourcePath(){return d.engineResourcePath}static set engineResourcePath(e){d.engineResourcePath=e}static get licenseServer(){return d.licenseServer}static set licenseServer(e){d.licenseServer=e}static get deviceFriendlyName(){return d.deviceFriendlyName}static set deviceFriendlyName(e){d.deviceFriendlyName=e}static get _onLog(){return d._onLog}static set _onLog(e){d._onLog=e}static get _bWasmDebug(){return d._bWasmDebug}static set _bWasmDebug(e){d._bWasmDebug=e}static get _bUseFullFeature(){return d._bUseFullFeature}static set _bUseFullFeature(e){d._bUseFullFeature=e}static get _dbrWorker(){return d._dbrWorker}static isLoaded(){return d.isLoaded()}static isWasmLoaded(){return d.isLoaded()}static loadWasm(){return d.loadWasm()}}U.DBR=U,U.BarcodeReader=d,U.EnumBarcodeColourMode=e.EnumBarcodeColourMode,U.EnumBarcodeComplementMode=e.EnumBarcodeComplementMode,U.EnumBarcodeFormat=e.EnumBarcodeFormat,U.EnumBarcodeFormat_2=e.EnumBarcodeFormat_2,U.EnumBinarizationMode=e.EnumBinarizationMode,U.EnumClarityCalculationMethod=e.EnumClarityCalculationMethod,U.EnumClarityFilterMode=e.EnumClarityFilterMode,U.EnumColourClusteringMode=e.EnumColourClusteringMode,U.EnumColourConversionMode=e.EnumColourConversionMode,U.EnumConflictMode=e.EnumConflictMode,U.EnumDeblurMode=e.EnumDeblurMode,U.EnumDeformationResistingMode=e.EnumDeformationResistingMode,U.EnumDPMCodeReadingMode=e.EnumDPMCodeReadingMode,U.EnumErrorCode=e.EnumErrorCode,U.EnumGrayscaleTransformationMode=e.EnumGrayscaleTransformationMode,U.EnumImagePixelFormat=e.EnumImagePixelFormat,U.EnumImagePreprocessingMode=e.EnumImagePreprocessingMode,U.EnumIMResultDataType=e.EnumIMResultDataType,U.EnumIntermediateResultSavingMode=e.EnumIntermediateResultSavingMode,U.EnumIntermediateResultType=e.EnumIntermediateResultType,U.EnumLocalizationMode=e.EnumLocalizationMode,U.EnumPDFReadingMode=e.EnumPDFReadingMode,U.EnumQRCodeErrorCorrectionLevel=e.EnumQRCodeErrorCorrectionLevel,U.EnumRegionPredetectionMode=e.EnumRegionPredetectionMode,U.EnumResultCoordinateType=e.EnumResultCoordinateType,U.EnumResultType=e.EnumResultType,U.EnumScaleUpMode=e.EnumScaleUpMode,U.EnumTerminatePhase=e.EnumTerminatePhase,U.EnumTextFilterMode=e.EnumTextFilterMode,U.EnumTextResultOrderMode=e.EnumTextResultOrderMode,U.EnumTextureDetectionMode=e.EnumTextureDetectionMode,e.BarcodeReader=d,e.DBR=U,e.default=U,Object.defineProperty(e,"__esModule",{value:!0})}));
